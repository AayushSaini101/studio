# Migration `20200506140303-initial`

This migration has been generated by fmvilas at 5/6/2020, 2:03:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."apis" (
"asyncapi" text  NOT NULL ,"computed_asyncapi" jsonb  NOT NULL ,"created_at" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"creator_id" integer  NOT NULL ,"id" SERIAL,"project_id" integer  NOT NULL ,"title" text  NOT NULL ,"version" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."invitations" (
"created_at" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"expires_at" timestamp(3)  NOT NULL ,"id" SERIAL,"inviter_id" integer  NOT NULL ,"organization_id" integer  NOT NULL ,"role" text  NOT NULL ,"scope" text   DEFAULT 'one',"uuid" text  NOT NULL )

CREATE TABLE "public"."organizations" (
"created_at" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"creator_id" integer  NOT NULL ,"feature_flags" jsonb   ,"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."organizations_users" (
"created_at" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"organization_id" integer  NOT NULL ,"role" text  NOT NULL DEFAULT 'member',"user_id" integer  NOT NULL )

CREATE TABLE "public"."projects" (
"created_at" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"creator_id" integer  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"organization_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."users" (
"avatar" text   ,"company" text   ,"created_at" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"display_name" text  NOT NULL ,"email" text  NOT NULL ,"feature_flags" jsonb   ,"id" SERIAL,"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "invitations.uuid" ON "public"."invitations"("uuid")

CREATE UNIQUE INDEX "organizations_users_organization_id_user_id" ON "public"."organizations_users"("organization_id","user_id")

CREATE UNIQUE INDEX "users.email" ON "public"."users"("email")

CREATE UNIQUE INDEX "users.username" ON "public"."users"("username")

ALTER TABLE "public"."apis" ADD FOREIGN KEY ("creator_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."apis" ADD FOREIGN KEY ("project_id")REFERENCES "public"."projects"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."invitations" ADD FOREIGN KEY ("inviter_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."invitations" ADD FOREIGN KEY ("organization_id")REFERENCES "public"."organizations"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."organizations" ADD FOREIGN KEY ("creator_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."organizations_users" ADD FOREIGN KEY ("organization_id")REFERENCES "public"."organizations"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."organizations_users" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."projects" ADD FOREIGN KEY ("creator_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."projects" ADD FOREIGN KEY ("organization_id")REFERENCES "public"."organizations"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200506140303-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,85 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model apis {
+  asyncapi          String
+  computedAsyncapi  Json      @map(name: "computed_asyncapi")
+  createdAt         DateTime? @default(now()) @map(name: "created_at")
+  creatorId         Int       @map(name: "creator_id")
+  id                Int       @default(autoincrement()) @id
+  projectId         Int       @map(name: "project_id")
+  title             String
+  version           String
+  creator           users     @relation(fields: [creatorId], references: [id])
+  project           projects  @relation(fields: [projectId], references: [id])
+}
+
+model invitations {
+  createdAt       DateTime?     @default(now()) @map(name: "created_at")
+  expiresAt       DateTime      @map(name: "expires_at")
+  id              Int           @default(autoincrement())
+  inviterId       Int           @map(name: "inviter_id")
+  organizationId  Int           @map(name: "organization_id")
+  role            String
+  scope           String?       @default("one")
+  uuid            String        @unique
+  inviter         users         @relation(fields: [inviterId], references: [id])
+  organization    organizations @relation(fields: [organizationId], references: [id])
+}
+
+model organizations {
+  createdAt                   DateTime?             @default(now()) @map(name: "created_at")
+  featureFlags                Json?                 @map(name: "feature_flags")
+  id                          Int                   @default(autoincrement()) @id
+  name                        String
+  creatorId                   Int                   @map(name: "creator_id")
+  invitations                 invitations[]
+  organizationUsers           organizationsUsers[]
+  projects                    projects[]
+  creator                     users                 @relation(fields: [creatorId], references: [id])
+}
+
+model organizationsUsers {
+  createdAt       DateTime?     @default(now()) @map(name: "created_at")
+  organizationId  Int           @map(name: "organization_id")
+  role            String        @default("member")
+  userId          Int           @map(name: "user_id")
+  organization    organizations @relation(fields: [organizationId], references: [id])
+  user            users         @relation(fields: [userId], references: [id])
+
+  @@unique([organizationId, userId], name: "organizations_users_organization_id_user_id")
+  @@map(name: "organizations_users")
+}
+
+model projects {
+  createdAt       DateTime?     @default(now()) @map(name: "created_at")
+  creatorId       Int           @map(name: "creator_id")
+  id              Int           @default(autoincrement()) @id
+  name            String
+  organizationId  Int           @map(name: "organization_id")
+  creator         users         @relation(fields: [creatorId], references: [id])
+  organization    organizations @relation(fields: [organizationId], references: [id])
+  apis            apis[]
+}
+
+model users {
+  avatar               String?
+  company              String?
+  createdAt            DateTime?             @default(now()) @map(name: "created_at")
+  displayName          String                @map(name: "display_name")
+  email                String                @unique
+  featureFlags         Json?                 @map(name: "feature_flags")
+  id                   Int                   @default(autoincrement()) @id
+  username             String                @unique
+  apis                 apis[]
+  invitations          invitations[]
+  organizationsForUser organizationsUsers[]
+  projects             projects[]
+  organizations        organizations[]
+}
```


