# Migration `20200506152925-initial`

This migration has been generated by fmvilas at 5/6/2020, 3:29:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."organizations.slug"

DROP INDEX "public"."users.github_id"

ALTER TABLE "public"."apis" DROP CONSTRAINT IF EXiSTS "apis_project_id_fkey",
DROP COLUMN "link_path",
DROP COLUMN "link_provider",
DROP COLUMN "link_ref",
DROP COLUMN "link_repo_id",
DROP COLUMN "project_id",
ADD COLUMN "project_id" integer  NOT NULL ;

ALTER TABLE "public"."organizations" DROP COLUMN "developer_portal_visibility",
DROP COLUMN "slug",
ADD COLUMN "creator_id" integer  NOT NULL ,
ALTER COLUMN "feature_flags" DROP NOT NULL;

ALTER TABLE "public"."users" DROP COLUMN "github_access_token",
DROP COLUMN "github_id",
DROP COLUMN "github_refresh_token",
ALTER COLUMN "feature_flags" DROP NOT NULL;

ALTER TABLE "public"."repos" DROP CONSTRAINT IF EXiSTS "repos_organization_fkey";

ALTER TABLE "public"."apis" ADD FOREIGN KEY ("project_id")REFERENCES "public"."projects"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."organizations" ADD FOREIGN KEY ("creator_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."repos";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200506152925-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,85 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model apis {
+  asyncapi          String
+  computedAsyncapi  Json      @map(name: "computed_asyncapi")
+  createdAt         DateTime? @default(now()) @map(name: "created_at")
+  creatorId         Int       @map(name: "creator_id")
+  id                Int       @default(autoincrement()) @id
+  projectId         Int       @map(name: "project_id")
+  title             String
+  version           String
+  creator           users     @relation(fields: [creatorId], references: [id])
+  project           projects  @relation(fields: [projectId], references: [id])
+}
+
+model invitations {
+  createdAt       DateTime?     @default(now()) @map(name: "created_at")
+  expiresAt       DateTime      @map(name: "expires_at")
+  id              Int           @default(autoincrement())
+  inviterId       Int           @map(name: "inviter_id")
+  organizationId  Int           @map(name: "organization_id")
+  role            String
+  scope           String?       @default("one")
+  uuid            String        @unique
+  inviter         users         @relation(fields: [inviterId], references: [id])
+  organization    organizations @relation(fields: [organizationId], references: [id])
+}
+
+model organizations {
+  createdAt                   DateTime?             @default(now()) @map(name: "created_at")
+  featureFlags                Json?                 @map(name: "feature_flags")
+  id                          Int                   @default(autoincrement()) @id
+  name                        String
+  creatorId                   Int                   @map(name: "creator_id")
+  invitations                 invitations[]
+  organizationUsers           organizationsUsers[]
+  projects                    projects[]
+  creator                     users                 @relation(fields: [creatorId], references: [id])
+}
+
+model organizationsUsers {
+  createdAt       DateTime?     @default(now()) @map(name: "created_at")
+  organizationId  Int           @map(name: "organization_id")
+  role            String        @default("member")
+  userId          Int           @map(name: "user_id")
+  organization    organizations @relation(fields: [organizationId], references: [id])
+  user            users         @relation(fields: [userId], references: [id])
+
+  @@unique([organizationId, userId], name: "organizations_users_organization_id_user_id")
+  @@map(name: "organizations_users")
+}
+
+model projects {
+  createdAt       DateTime?     @default(now()) @map(name: "created_at")
+  creatorId       Int           @map(name: "creator_id")
+  id              Int           @default(autoincrement()) @id
+  name            String
+  organizationId  Int           @map(name: "organization_id")
+  creator         users         @relation(fields: [creatorId], references: [id])
+  organization    organizations @relation(fields: [organizationId], references: [id])
+  apis            apis[]
+}
+
+model users {
+  avatar               String?
+  company              String?
+  createdAt            DateTime?             @default(now()) @map(name: "created_at")
+  displayName          String                @map(name: "display_name")
+  email                String                @unique
+  featureFlags         Json?                 @map(name: "feature_flags")
+  id                   Int                   @default(autoincrement()) @id
+  username             String                @unique
+  apis                 apis[]
+  invitations          invitations[]
+  organizationsForUser organizationsUsers[]
+  projects             projects[]
+  organizations        organizations[]
+}
```


